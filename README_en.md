# KNUTIL SCENE MANAGER
"KNUTIL" is a library for PICO-8 that contains functions frequently used in the games I have created.
I have kept the functions that were eventually needed in the production.

This cart shows an animation of the scene functions in action.


![knutil_2](https://user-images.githubusercontent.com/8139723/109604067-3b7f2100-7b66-11eb-92ee-94b1b890f337.gif)

 **SCENE MANAGER** controls and swaps the order of function calls with fewer tokens by means of consecutive string instructions.  
The generated SCENE can register global functions as ORDERs.  
The registered ORDER is retrieved by SCENE and repeated for the specified length of time.  
When processing is completed, the next ORDER is repeated.

## Feature Overview
"KNUTIL" is a library for PICO-8 that contains functions that are frequently used in the games I have created.
I've kept the functions that I eventually needed in my production.

In this cart, I show you how the scene functions work with animations.
Z key: Execute the order command.
Up/Down: Select the order command.

 **SCENE MANAGER** controls and replaces the order in which functions are called with a small number of tokens by using consecutive string instructions.  
The generated SCENE can register a global function as an ORDER.  
One of the registered ORDERS is retrieved by SCENE and the process is repeated for the specified length.  
When the processing is finished, it repeats the processing of the next ORDER.  
This is expected to facilitate the planning of the performance.  

## Using SCENE
<details>
### Create a SCENE ( MKSCENES )
```
SCENES = MKSCENES( { 'UPD', 'DRW', 'KEY' } )
```
SCENES: Contains the generated SCENEs.

### Enter an ORDER into a SCENE ( CMDSCENES )
```
CMDSCENES([[
[SCENE NAME] [COMMAND] [FUNCTION NAME] [DURATION FRAME]
[SCENE NAME] [COMMAND] [FUNCTION NAME] [DURATION FRAME]
...
]])
```
- [SCENE NAME] : Specify the name generated by MKSCENES.
- [COMMAND] : Specify the following ORDER COMMANDS.
- [FUNCTION NAME] : Specify the name of the global function.
- [DURATION FRAME]: Specifies the number of frames to be sustained; if set to 0, it will not automatically terminate.

</details>
## ORDER COMMANDS
<details>
### ST (SET): Delete all stacked ORDERS in SCENE and set new ORDERS.
```
CMDSCENES[[
UPD ST MANAGE 0
]]
```
Clean the SCENE "UPD" and add a "FUNCTION MANAGE".

### PS (PUSH): Add an ORDER to the SCENE
```
CMDSCENES[[
KEY PS KEYCHECK 0
]]
```
Add the SCENE "KEY" with "FUNCTION KEYCHECK" at the top.

### US (UNSHIFT): interrupt ORDER at the beginning of a SCENE.
```
CMDSCENES[[
DRW US DRAWRECT 200
DRW US NIL 100
DRW US DRAWCIRC 200
]]
```
Scene "DRW" is executed in the ORDER of DRAWCIRC, NIL, DRAWRECT.

### RM (REMOVE): remove one ORDER.
```
CMDSCENES[[
DRW RM
]]
```
Removes the first ORDER of the SCENE "DRW".

```
CMDSCENES[[
DRW RM DRAWRECT
]]
```
Deletes the DRAWRECT ORDER of SCENE "DRW", starting from the top.

### CL (CLEAR): Remove all stacked ORDERS from the SCENE.
```
CMDSCENES[[
KEY CL
]]
```
Deletes all the ORDERS registered in the SCENE "KEY".

### FI (FIND): Search and retrieve ORDERS from a SCENE.
```
RES = CMDSCENES[[
DRW FI DRAWRECT
]]
```
In this case, the return value RES is a table, and the ORDER "DRAWRECT" is in the first element.

</details>
## Create a function for ORDERS.
<details>
```
FUNCTION KEYCHECK( ORDER )
	PRINT('PROCESSIONG ORDER')
END
```
</details>
## Run each SCENE.
<details>
```
## In the _UPDATE() and _DRAW() functions
FOR I,V IN PAIRS(SCENES) DO
	V.TRA()
END
```
</details>
## ORDER function
<details>
```
FUNCTION [FUNCTION NAME] ( ORDER )
	CLS()
	IF ORDER.FST THEN
		STOP"IT'S FIRST!"
	END
	IF ORDER.LST THEN
		STOP"IT'S LAST!"
	END
	PRINT('COUNT: '..ORDER.CNT..'/'..ORDER.DUR)
END
```
</details>

## Properties of ORDER

<details>
### FST / LST
ORDER.FST : at first execution
ORDER.LST : at the last execution.

### CNT / DUR
ORDER.CNT : Execution count of the currently running ORDER.
ORDER.DUR : Count of expected end of the currently running ORDER.

### PRM
It contains the value specified in the second argument of CMDSCENES.

### RATE
Used to specify the end from the start, e.g. in coordinates.
````
ORDER.rate('[start] [end]', duration, count )
```
The default values for duration and count are the ones specified in CMDSCENES.

### Force ORDER termination.
Do `return 1`
 or
do `ORDER.rm = 1`.
</details>

## Functions other than scenes

### There is one in this library that I have already posted.
[CAT](https://www.lexaloffle.com/bbs/?tid=41798): Concatenate tables. Indexes are added last and identical keys are overwritten.
<details>[#concat___table#]</details>

[COMB](https://www.lexaloffle.com/bbs/?tid=46985): Combines two tables to create a hash table.
<details>[#combine_table#]</details>

[DMP](https://www.lexaloffle.com/bbs/?tid=32830): Dumps information about a variable.
<details>[#vdmplua#]</details>

[HTBL](https://www.lexaloffle.com/bbs/?tid=36325): Converting a string to a table(Multidimensional Array / Hash Table / Jagged Arrays)
<details>[#stringhashtable#]</details>

[INRNG](https://www.lexaloffle.com/bbs/?tid=35802): Tests that the specified value is within a range.
<details>[#knutil_inrng#]</details>

[JOIN](https://www.lexaloffle.com/bbs/?tid=32551): Joins strings with a delimiter.
<details>[#knutil_join#]</details>

[RCEACH](https://www.lexaloffle.com/bbs/?tid=36681): Iterate from rectangle values.
<details>[#rceach#]</details>

[REPLACE](https://www.lexaloffle.com/bbs/?tid=32640): Perform string substitutions.
<details>[#knutil_replace#]</details>

[TMAP](https://www.lexaloffle.com/bbs/?tid=38126): More compact operable foreach iterator.
<details>[#tablemap#]</details>

[TBFILL](https://www.lexaloffle.com/bbs/?tid=32541): Creates a table filled with the specified values.
<details>[#knutil_tbfill#]</details>

[TTABLE](https://www.lexaloffle.com/bbs/?tid=32573): If the argument is a table, the table is returned.
<details>[#knutil_ttable#]</details>


### Functions not posted on BBS. (I will post them some other time)
**TONORM**: String to type conversion(boolian, nil, number).
**TOHEX**: Convert hexadecimal string without "0x".
**TTOH**: Sum the numbers in argument 1 by shifting bits to argument 2.
**HTOT**: Divide an integer value into 8 bits and make it into a table.
**EXRECT(RFMT)**: Drawing and overlap judgment with the generated rectangle.
**TOC**: Divide the value and exclude the remainder.
**SPLIT(wrapper function)**: Split() for two-dimensional support. Defaults to space separator.
**HTD**: Convert a hexadecimal string to a 4-bit-16-bit table.
**SLICE**: Cuts out the table at the specified index.
**OUTLINE**: Display text with edges.
**MKPAL**: Create a table to be used in pal(), specifying the colors before and after the change.
**ECMKPAL**: Generate a set of tables to be retrieved by MKPAL().
**ECPALT**: Run palt() on the table.
**AMID**: Expand the arguments to positive and negative and do mid().
**BMCH**: *Compares two values to judge that they both have a bit in common.* **"Bitwise operators" make it less significant.**

### UPDATE HISTORY
<details>
**v0.9**
- tbfill: changed to specify indexes at the beginning and end of tables, support for variable length arguments.
- tohex: fixed for update of tbfill()

**v0.8**
- join: use of tuples
- tbfill: defaults to 1 or specifies the start of the table
- tohex: support for updating join()

**v0.7**
- sceneorder:"rate" func countermeasures against overflow of digits
- code update saved token: 
 - htbl: 7 tokens
 - tonorm: 9 tokens

**v0.6**
- simplified handling of scene orders
- rceach: name change from ecxy()
- inrng: using tupple twice
- exrect.con: name change from exrect.cont()
- exrect.hov: name change from exrect.hover()
- scenes: order.rate is calculated enough value in the last count
- cmdscenes: change name from scenesbat

**v0.5**
Mainly due to sub()'s CPU cost countermeasure.
- replace: fix usage of sub()
- htd: Convert from split()
- htbl: Run newlines without replace()
- scene: Save cost with split()&comb() at initialization
- dbg: Change to display values without dbg() argument
- example: Add htbl() example use
</details>