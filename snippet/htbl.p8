pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--htbl
--v0.4
--@shiftalow / bitchunk

--[[
	- htbl         	    -- convert from string to hash table.
	- @param  string ht -- parsing character string.
	- @return table     -- generated table value.
	- @description
	-- a single string can initialize many values.
	-- returns at least an empty table.
	-- elements can be added space-separated. (the space character cannot be used as a value.)
	-- {} specifies a table.
	-- key=val; key{val} specifies the key and value of the table.
	-- newline codes are ignored.
	-- bool values, nil, and hexadecimal strings are automatically normalized.
	-- the first level can be initialized with global values by using cat() in _env.
]]--


function htbl(ht,c)
	local t,k,rt={}
	ht,c=split(ht,'') or ht,c or 1
	while 1 do
		local p=ht[c]
		c+=1
		if p=='{' or p=='=' then
			rt,c=htbl(ht,c)
			if not k then
				add(t,rt)
			else
				t[k],k=p=='{' and rt or rt[1]
			end
		elseif not p or p=='}' or p==';' or p==' ' then
			if k=='false' then k=false
			elseif k=='nil' then k=nil
			else k=k=='true' or tonum(k) or k
			end
			add(t,k)
			rt,k=p and c or nil
			if p~=' ' then
				break
			end
		elseif p~="\n" then
			k=(k or '')..p
		end
	end
	return t,rt
end

----

cls()

for i,v in pairs(htbl('i â™¥ ðŸ±')) do
print(i..': \fe'..v,7)
end

for j,t in pairs(htbl('â¬†ï¸{up 20}â¬‡ï¸{down 20}')) do
for i,v in pairs(t) do
print(j..'\fb ['..i..': '..v..']',7)
end
end

for j,t in pairs(htbl[[
x=40;
y=80;
t=dog;
i{collar bone frisbee{1 2 3}}
{}
]]
) do
for i,v in pairs(type(t)=='table' and t or {t}) do
 local s
	if type(v)=='table' then
	 s='{'
		for i,w in pairs(v) do
			s=s..' '..w
		end
		s=s..' }'
	end
	print(j..'\ff ['..i..': '..(s or v)..']',7)
	end
end


-->8
--update history
--[[
**v0.4**
- cut token costs (-12 tokens)
-	tonorm() is now built-in.
		the second return value of the final result is now nil.
	 (be careful when doing add())
- document inserted.
**v0.3**
- code update saved:
- htbl -7 tokens
- tonorm -9 tokens
**v0.2**
- run newlines without replace()
**v0.1**
- first version
]]--
-->8
--other version code
--[[
--v0.3a
function htbl(ht,c)
local t,k,rt={}
ht,c=split(ht,'') or ht,c or 1
while ht[c] do
local p=ht[c]
c+=1
if p=='{' or p=='=' then
rt,c=htbl(ht,c)
if not k then
add(t,rt)
else
t[k],k=p=='{' and rt or rt[1]
end
elseif p=='}' or p==';' or p==' ' then
add(t,tonorm(k))
k=nil
if p~=' ' then
return t,c
end
elseif p~="\n" then
k=(k or '')..p
end
end
add(t,tonorm(k))
return t
end

--v0.3
function htbl(ht,c)
	local t,k,rt={}
	ht,c=split(ht,'') or ht,c or 1
	while ht[c] do
		local p=ht[c]
		c+=1
		if p=='{' or p=='=' then
			rt,c=htbl(ht,c)
			if p=='=' then
				t[k],k=rt[1]
			elseif k then
				t[k],k=rt
			else
				add(t,rt)
			end
		elseif p=='}' or p==';' then
			add(t,tonorm(k))
			return t,c
		elseif p==' ' then
			add(t,tonorm(k))
			k=nil
		elseif p~="\n" then
			k=(k or '')..p
		end
	end
	add(t,tonorm(k))
	return t
end

]]
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
770000000000eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700070000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700000000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0700070000000e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777000000000eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7770000000000ee0ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000000eeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7770000000000eeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000700000000eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777000000000000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777000000000e00000e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000000eeeeeee0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077000000000e0eee0e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
007007000000e0eee0e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
7770000000000eeeee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bb0000000000b0b0bbb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777077700000b0000b000b000000b0b0b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b0000b0000000000b0b0bbb000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b0000b000b000000b0b0b00000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bbb0000000000bb0b0000bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bbb000000000bbb0bbb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777077700000b00000b00b00000000b0b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b000bbb000000000bbb0b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b000b0000b000000b000b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bbb000000000bbb0bbb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bb0000000000bb000bb0b0b0bb000bb000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b0000b000b000000b0b0b0b0b0b0b0b000b000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b0000b0000000000b0b0b0b0b0b0b0b000b000000000000000000000000000000000000000000000000000000000000000000000000000000000
777077700000b0000b000b000000b0b0b0b0bbb0b0b000b000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bbb000000000bbb0bb00bbb0b0b00bb000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bbb000000000bbb0bbb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b00000b00b00000000b0b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
770007700000b000bbb000000000bbb0b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
777077700000b000b0000b000000b000b0b000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
077777000000bb00bbb000000000bbb0bbb00bb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000ff00ff0000000000f0f0fff00ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000f0000f000f000000f0f0f0f000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f0000000000fff0f0f000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000f0000f000f00000000f0f0f000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000ff00fff00000000000f0fff00ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000ff00ff0000000000fff0fff00ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70700000f0000f000f000000f0f0f0f000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000f0000f0000000000fff0f0f000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000f0000f000f000000f0f0f0f000f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00fff000000000fff0fff00ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00ff0000000000ff000ff00ff00ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f000f000000f0f0f0f0f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f0000000000f0f0f0f0f00000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f000f000000f0f0f0f0f0f000f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000ff00fff000000000fff0ff00fff00ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00ff00000000000ff00ff0f000f000fff0fff00ff00000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f000f000000f000f0f0f000f000f0f0f0f000f00000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f0000000000f000f0f0f000f000fff0ff0000f00000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f0000f000f000000f000f0f0f000f000f0f0f0f000f00000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00fff0000000000ff0ff00fff0fff0f0f0f0f00ff00000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00fff000000000fff00ff0ff00fff00ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f00000f00f000000f0f0f0f0f0f0f00000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f000fff000000000ff00f0f0f0f0ff0000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000f000f0000f000000f0f0f0f0f0f0f00000f0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00fff000000000fff0ff00f0f0fff00ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000ff00fff0fff0fff00ff0fff0fff0fff0000000000ff00000ff000000fff00000fff00000ff000ff00000000000000000000000000000000000000000
07000000f000f000f0f00f00f000f0f0f000f0000f0000000f0000000f00000000f0000000f000000f0000f00000000000000000000000000000000000000000
07000000f000ff00ff000f00fff0ff00ff00ff0000000000ff0000000f000000fff000000ff000000ff000f00000000000000000000000000000000000000000
07000000f000f000f0f00f0000f0f0f0f000f0000f0000000f0000000f000000f000000000f000000f0000f00000000000000000000000000000000000000000
77700000ff00f000f0f0fff0ff00fff0fff0fff0000000000ff00000fff00000fff00000fff00000ff000ff00000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
70000000888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

