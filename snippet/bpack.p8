pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
--bpack
--v0.2a
--@shiftalow / bitchunk

--[[
	- bpack              -- pack the value of the bit specification with bit width.
	- @param  table  w   -- bit width table for packing.
	- @param  number s   -- bit value to be shifted to the left before the first pack.
	- @param  number b   -- the value to pack.
	- @param  number ... -- bit width to the next pack.
	- @return number     -- return packed value.
	- @description
		- if multiple bit values are specified, pack toward the most significant bit.
		- to start bit packing from the decimal point bit, set [number s] to a negative value.
		- if there are fewer bit width elements for the value to pack, the bit width elements are rotated.
]]--

---- big-endian(b=0xf8a1&s=12:[f,8,a,1])
--function bpack(w,s,b,...)
--return b and flr(0x.ffff<<add(w,deli(w,1))&b)<<s|bpack(w,s-w[1],...) or 0
--end

-- little-endian(b=0xf8a1&s=0:[1,a,8,f])
function bpack(w,s,b,...)
return b and flr(0x.ffff<<add(w,deli(w,1))&b)<<s|bpack(w,s+w[#w],...) or 0
end

----
cls()

v=bpack({8,4},0,0xff,0xb)
?'\n\f9★\f6 bit-width elements \fb{8,4}\f6'
?'         pack "0xff" and "0xb".\n'
?tostr(v,1)..'\f6 --bit-left-shifted:0',7

v=bpack({8,4},4,0xff,0xb)
?''..tostr(v,1)..'\f6 --bit-left-shifted:4',7


?'\n\n\f9★\f6 bit-width elements \fb{4,4,8}\f6'
?'                   are rotated.'
?'               (-16bit shifted)'
v=bpack({4,4,8},-16,1,2,4,8,3,5)
?tostr(v,1)..'\fd --vals(1,2,4,8,3,5) ',7
?'  ◀◀◀◀ ◀◀◀◀\f2 --bitw(4,4,8,4,4,8) ',7


v=bpack({1},-16
		,unpack(split(
			'11111111'   -- from:32 to:25
			..'01111111' -- from:24 to:17
			..'11111001' -- from:16 to: 9
			..'10000001' -- from:8  to: 1
	,''))
	)

--bit unpack from "knutil" library
function bunpack(b,s,w,...)
if w then
return flr(0x.ffff<<w&b>>>s),bunpack(b,s-(... or 0),...)
end
end
--** **--

?'\n\n\f9★\f6 specify 32-bit values'
?'             "1" bit at a time.'
?'             \fd--val('..tostr(v,1)..')\f6'
s=''
for i=0,7 do
x=2
rectfill(x+i*13,108,x+i*13+13,115,i%2==1 and 13 or 2)
end
for i,v in pairs({bunpack(v,15,unpack(split('11111111111111111111111111111111','')))}) do
?'。\+ci。\+ci。',i*3+flr((i-1)/4),106,v==1 and (i-1)%4+8 or 0
end

-->8
--[[
update history
**v0.2a**
- changed the bit shift direction at the start of packing (negative is toward the decimal point).
**v0.2**
- change the bit order to little endian.
**v0.1**
- first release
]]--

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000000066606660666000006060666066006660606000006660600066606660666066006660066000000bb0bbb00000b0b0bb0000000000000000000000
00999000000060600600060000006060060060600600606000006000600060006660600060600600600000000b00b0b00000b0b00b0000000000000000000000
9999999000006600060006006660606006006060060066600000660060006600606066006060060066600000bb00bbb00000bbb00bb000000000000000000000
09999900000060600600060000006660060060600600606000006000600060006060600060600600006000000b00b0b00b0000b00b0000000000000000000000
09000900000066606660060000006660666066600600606000006660666066606060666060600600660000000bb0bbb0b00000b0bb0000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000066606660066060600000606066606060666066606060000066606600660000006060666060606660606000000000
00000000000000000000000000000000000060606060600060600000606060606060600060006060000060606060606000006060606060606060606000000000
00000000000000000000000000000000000066606660600066000000000060600600660066000000000066606060606000000000606006006600000000000000
00000000000000000000000000000000000060006060600060600000000060606060600060000000000060606060606000000000606060606060000000000000
00000000000000000000000000000000000060006060066060600000000066606060600060000000000060606060666000000000666060606660000006000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707070777077707770777000007770777077707770000000000000666066600660606066600000066060606660666066606660660000006660000000000000
70707070707070707000700000007070707070707070000000000000606006006000606006000000600060600600600006006000606006006060000000000000
70700700707077007700770000007070707070707070000066606660660006006000666006006660666066600600660006006600606000006060000000000000
70707070707070707000700000007070707070707070000000000000606006006060606006000000006060600600600006006000606006006060000000000000
77707070777077707000700007007770777077707770000000000000606066606660606006000000660060606660600006006660666000006660000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707070777077707770777000007770777077707770000000000000666066600660606066600000066060606660666066606660660000006660000000000000
70707070707070707070707000007000700070707070000000000000606006006000606006000000600060600600600006006000606006006060000000000000
70700700707070707070770000007700770070707070000066606660660006006000666006006660666066600600660006006600606000006660000000000000
70707070707070707070707000007000700070707070000000000000606006006060606006000000006060600600600006006000606006006060000000000000
77707070777077707770777007007000700077707770000000000000606066606660606006000000660060606660600006006660666000006660000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000000066606660666000006060666066006660606000006660600066606660666066006660066000000bb0b0b00000b0b00000bbb0bb00000000000000
00999000000060600600060000006060060060600600606000006000600060006660600060600600600000000b00b0b00000b0b00000b0b00b00000000000000
9999999000006600060006006660606006006060060066600000660060006600606066006060060066600000bb00bbb00000bbb00000bbb00bb0000000000000
09999900000060600600060000006660060060600600606000006000600060006060600060600600006000000b0000b00b0000b00b00b0b00b00000000000000
09000900000066606660060000006660666066600600606000006660666066606060666060600600660000000bb000b0b00000b0b000bbb0bb00000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000006660666066600000666006606660666066606660660000000000
00000000000000000000000000000000000000000000000000000000000000000000000000006060606060000000606060600600606006006000606000000000
00000000000000000000000000000000000000000000000000000000000000000000000000006660660066000000660060600600666006006600606000000000
00000000000000000000000000000000000000000000000000000000000000000000000000006060606060000000606060600600606006006000606000000000
00000000000000000000000000000000000000000000000000000000000000000000000000006060606066600000606066000600606006006660666006000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77707070777077707770777000007770707077707700000000000000d0d0ddd0d0000dd00d00dd000000ddd00000d0d00000ddd00000ddd00000ddd00d000000
70707070707070000070707000007070707000700700000000000000d0d0d0d0d000d000d0000d00000000d00000d0d00000d0d0000000d00000d00000d00000
707007007070777007707770000070707770777007000000ddd0ddd0d0d0ddd0d000ddd0d0000d000000ddd00000ddd00000ddd000000dd00000ddd000d00000
70707070707000700070707000007070007070000700000000000000ddd0d0d0d00000d0d0000d000d00d0000d0000d00d00d0d00d0000d00d0000d000d00000
777070707770777077707770070077700070777077700000000000000d00d0d0ddd0dd000d00ddd0d000ddd0d00000d0d000ddd0d000ddd0d000ddd00d000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007000700070007000000070007000700070000000000000222022202220202002002020000020200000222000002020000020200000222002000000
00000000077007700770077000000770077007700770000000000000202002000200202020002020000020200000202000002020000020200000202000200000
00000000777077707770777000007770777077707770000022202220220002000200202020002220000022200000222000002220000022200000222000200000
00000000077007700770077000000770077007700770000000000000202002000200222020000020020000200200202002000020020000200200202000200000
00000000007000700070007000000070007000700070000000000000222022200200222002000020200000202000222020000020200000202000222002000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00090000000006606660666006606660666060600000666066600000666066606660000060606660600060606660066000000000000000000000000000000000
00999000000060006060600060000600600060600000006000600000606006000600000060606060600060606000600000000000000000000000000000000000
99999990000066606660660060000600660066600000066066606660660006000600000060606660600060606600666000000000000000000000000000000000
09999900000000606000600060000600600000600000006060000000606006000600000066606060600060606000006000000000000000000000000000000000
09000900000066006000666006606660600066600000666066600000666066600600000006006060666006606660660000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000006060660060600000666066606660000066606660000066600000666066606660666000000000
00000000000000000000000000000000000000000000000000006060060060600000606006000600000060600600000060600000060006006660600000000000
00000000000000000000000000000000000000000000000000000000060000000000660006000600000066600600000066600000060006006060660000000000
00000000000000000000000000000000000000000000000000000000060000000000606006000600000060600600000060600000060006006060600000000000
00000000000000000000000000000000000000000000000000000000666000000000666066600600000060600600000060600000060066606060666006000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000d0d0ddd0d0000d00ddd0d0d0ddd0dd00ddd0ddd00000ddd0ddd0ddd0ddd00d000000
000000000000000000000000000000000000000000000000000000000000d0d0d0d0d000d000d0d0d0d0d0d00d00d0d0d0000000d000d000d000d00000d00000
0000000000000000000000000000000000000000000000000000ddd0ddd0d0d0ddd0d000d000d0d00d00ddd00d00ddd0dd000000dd00dd00dd00dd0000d00000
000000000000000000000000000000000000000000000000000000000000ddd0d0d0d000d000d0d0d0d0d0d00d0000d0d0000000d000d000d000d00000d00000
0000000000000000000000000000000000000000000000000000000000000d00d0d0ddd00d00ddd0d0d0ddd0ddd000d0d0000d00d000ddd0d000d0000d000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
002222222222222ddddddddddddd2222222222222ddddddddddddd2222222222222ddddddddddddd2222222222222dddddddddddddd000000000000000000000
002882002002002d00d00d00dbbd2882002002bb2d88d99daadbbd2882992aa2bb2d88d99daad00d2882992aa2bb2d88d99daadbbdd000000000000000000000
002882002002002d00d00d00dbbd2882002002bb2d88d99daadbbd2882992aa2bb2d88d99daad00d2882992aa2bb2d88d99daadbbdd000000000000000000000
002882002002002d00d00d00dbbd2882002002bb2d88d99daadbbd2882992aa2bb2d88d99daad00d2882992aa2bb2d88d99daadbbdd000000000000000000000
002882002002002d00d00d00dbbd2882002002bb2d88d99daadbbd2882992aa2bb2d88d99daad00d2882992aa2bb2d88d99daadbbdd000000000000000000000
002882002002002d00d00d00dbbd2882002002bb2d88d99daadbbd2882992aa2bb2d88d99daad00d2882992aa2bb2d88d99daadbbdd000000000000000000000
002882002002002d00d00d00dbbd2882002002bb2d88d99daadbbd2882992aa2bb2d88d99daad00d2882992aa2bb2d88d99daadbbdd000000000000000000000
002222222222222ddddddddddddd2222222222222ddddddddddddd2222222222222ddddddddddddd2222222222222dddddddddddddd000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

