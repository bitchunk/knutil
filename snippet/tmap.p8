pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--tmap
--v0.2
--@shiftalow / bitchunk

--[[
	- tmap               -- more flexible foreach().
	- @param  table    t -- table for scanning each element.
	- @param  function f -- function to execute for each element.
	- @return table      -- table after the function is executed.
	
	- @description
		-- execute as many functions as there are elements in the table.
					the arguments of the function to be executed are the element value, index and key value.
					passing a return value in the function will update the table elements.

		-- the basic function to be specified.
				 function(v,i)
	     return r
					end
				 @param  any v -- current table element.
					@param  any i -- index or key of the current table element.
				 @return any r -- value to update the current element.
]]--

function tmap(t,f)
for i,v in pairs(t) do
v=f(v,i)
if v~=nil then
t[i]=v
end
end
return t
end

----
 
cls()

?'-------------'
?'--your food--'
?'-------------'
local t={
	'toast'
	,'letus'
	,'bacon'
	,'cheese'
}
t=tmap(t, function(v,i)
 ?i..'..'..v,9
end)

?"\nit's time for lunch!\nwhat do you want to eat?",11
local q,x,y=1,cursor()
::_1::
poke(0x5f30,1)
q=mid(1,#t,q+tonum(btnp(1))-tonum(btnp(0)))
?'███',x,y,0
?'?:'..q,x,y,7
flip()
if not btnp(6) then
goto _1
end
deli(t,q)
--[[
 the first argument is
  the table,

 the second argument specifies
  the function to be
  applied to each 
  table element.

 the return value is
  the table of arguments.
]]

?'----------------',6
?'--enhance food--'
?'----------------'
t=tmap(t, function(v,i)
 v='super★'..v
 ?i..'..'..v,10
 return v
end)

?"\nit's time for dinner!\nwhat do you want to eat?",11
local q,x,y=1,cursor()
::_2::
poke(0x5f30,1)
q=mid(1,#t,q+tonum(btnp(1))-tonum(btnp(0)))
?'███',x,y,0
?'?:'..q,x,y,7
flip()
if not btnp(6) then
goto _2
end
deli(t,q)

--[[
	array elements can be
		updated by specifying
		the return value
		in the function.
]]

?'------------------',6
?'--change weapons--'
?'------------------'
t=tmap({
	'shield'
	,'armor'
	,'sword'
	,'ring'
}, function(v,i)
	if t[i] then
	 v=t[i]..'•'..v
	 ?i..'..'..v,12
	end
 return v
end)

-->8
--[[
update history
**v0.2**
 - support for updating table elements to false.
 - documentation was adapted to other library formats.
 - the previous version of the code was commented out as the shortest version.

-- shortest version
function tmap(t,f)
for i,v in pairs(t) do
t[i]=f(v,i) or t[i]
end
return t
end

**v0.1**
	- first release
]]--

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__label__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660666066606660666066606660666066606660666066600000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000606006606060666000006660066006606600000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000606060606060606000006000606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660666060606060660000006600606060606060666066600000000000000000000000000000000000000000000000000000000000000000000000000000
00000000006060606060606000006000606060606060000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666066000660606000006000660066006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660666066606660666066606660666066606660666066600000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99000000000099900990999009909990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09000000000009009090909090000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09000000000009009090999099900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09000000000009009090909000900900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900900090009009900909099000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900000000090009990999090900990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900000000090009000090090909000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900000000090009900090090909990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90000000000090009000090090900090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900900090099909990090009909900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900000000099909990099009909900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900000000090909090900090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09900000000099009990900090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900000000090909090900090909090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900900090099909090099099009090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90900000000009909090999099900990999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90900000000090009090900090009000900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99900000000090009990990099009990990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900000000090009090900090000090900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00900900090009909090999099909900999000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb0bbb00b000bb00000bbb0bbb0bbb0bbb00000bbb00bb0bbb00000b000b0b0bb000bb0b0b00b00000000000000000000000000000000000000000000000000
0b000b00b000b00000000b000b00bbb0b0000000b000b0b0b0b00000b000b0b0b0b0b000b0b00b00000000000000000000000000000000000000000000000000
0b000b000000bbb000000b000b00b0b0bb000000bb00b0b0bb000000b000b0b0b0b0b000bbb00b00000000000000000000000000000000000000000000000000
0b000b00000000b000000b000b00b0b0b0000000b000b0b0b0b00000b000b0b0b0b0b000b0b00000000000000000000000000000000000000000000000000000
bbb00b000000bb0000000b00bbb0b0b0bbb00000b000bb00b0b00000bbb00bb0b0b00bb0b0b00b00000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b0b0b0b0bbb0bbb00000bb000bb00000b0b00bb0b0b00000b0b0bbb0bb00bbb00000bbb00bb00000bbb0bbb0bbb0bbb000000000000000000000000000000000
b0b0b0b0b0b00b000000b0b0b0b00000b0b0b0b0b0b00000b0b0b0b0b0b00b0000000b00b0b00000b000b0b00b0000b000000000000000000000000000000000
b0b0bbb0bbb00b000000b0b0b0b00000bbb0b0b0b0b00000b0b0bbb0b0b00b0000000b00b0b00000bb00bbb00b000bb000000000000000000000000000000000
bbb0b0b0b0b00b000000b0b0b0b0000000b0b0b0b0b00000bbb0b0b0b0b00b0000000b00b0b00000b000b0b00b00000000000000000000000000000000000000
bbb0b0b0b0b00b000000bbb0bb000000bbb0bb000bb00000bbb0b0b0b0b00b0000000b00bb000000bbb0b0b00b000b0000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660666066606660666066606660666066606660666066606660666066600000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000666066006060666066000660666000006660066006606600000000000000000000000000000000000000000000000000000000000000000000000000
00000000600060606060606060606000600000006000606060606060000000000000000000000000000000000000000000000000000000000000000000000000
66606660660060606660666060606000660000006600606060606060666066600000000000000000000000000000000000000000000000000000000000000000
00000000600060606060606060606000600000006000606060606060000000000000000000000000000000000000000000000000000000000000000000000000
00000000666060606060606060600660666000006000660066006660000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66606660666066606660666066606660666066606660666066606660666066600000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aa00000000000aa0a0a0aaa0aaa0aaa0000a0000a000aaa0aaa0a0a00aa000000000000000000000000000000000000000000000000000000000000000000000
0a0000000000a000a0a0a0a0a000a0a000aaa000a000a0000a00a0a0a00000000000000000000000000000000000000000000000000000000000000000000000
0a0000000000aaa0a0a0aaa0aa00aa00aaaaaaa0a000aa000a00a0a0aaa000000000000000000000000000000000000000000000000000000000000000000000
0a000000000000a0a0a0a000a000a0a00aaaaa00a000a0000a00a0a000a000000000000000000000000000000000000000000000000000000000000000000000
aaa00a000a00aa000aa0a000aaa0a0a00a000a00aaa0aaa00a000aa0aa0000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa0000000000aa0a0a0aaa0aaa0aaa0000a0000aaa0aaa00aa00aa0aa0000000000000000000000000000000000000000000000000000000000000000000000
00a000000000a000a0a0a0a0a000a0a000aaa000a0a0a0a0a000a0a0a0a000000000000000000000000000000000000000000000000000000000000000000000
aaa000000000aaa0a0a0aaa0aa00aa00aaaaaaa0aa00aaa0a000a0a0a0a000000000000000000000000000000000000000000000000000000000000000000000
a0000000000000a0a0a0a000a000a0a00aaaaa00a0a0a0a0a000a0a0a0a000000000000000000000000000000000000000000000000000000000000000000000
aaa00a000a00aa000aa0a000aaa0a0a00a000a00aaa0a0a00aa0aa00a0a000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa0000000000aa0a0a0aaa0aaa0aaa0000a00000aa0a0a0aaa0aaa00aa0aaa00000000000000000000000000000000000000000000000000000000000000000
00a000000000a000a0a0a0a0a000a0a000aaa000a000a0a0a000a000a000a0000000000000000000000000000000000000000000000000000000000000000000
0aa000000000aaa0a0a0aaa0aa00aa00aaaaaaa0a000aaa0aa00aa00aaa0aa000000000000000000000000000000000000000000000000000000000000000000
00a00000000000a0a0a0a000a000a0a00aaaaa00a000a0a0a000a00000a0a0000000000000000000000000000000000000000000000000000000000000000000
aaa00a000a00aa000aa0a000aaa0a0a00a000a000aa0a0a0aaa0aaa0aa00aaa00000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bbb0bbb00b000bb00000bbb0bbb0bbb0bbb00000bbb00bb0bbb00000bb00bbb0bb00bb00bbb0bbb00b0000000000000000000000000000000000000000000000
0b000b00b000b00000000b000b00bbb0b0000000b000b0b0b0b00000b0b00b00b0b0b0b0b000b0b00b0000000000000000000000000000000000000000000000
0b000b000000bbb000000b000b00b0b0bb000000bb00b0b0bb000000b0b00b00b0b0b0b0bb00bb000b0000000000000000000000000000000000000000000000
0b000b00000000b000000b000b00b0b0b0000000b000b0b0b0b00000b0b00b00b0b0b0b0b000b0b0000000000000000000000000000000000000000000000000
bbb00b000000bb0000000b00bbb0b0b0bbb00000b000bb00b0b00000bbb0bbb0b0b0b0b0bbb0b0b00b0000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b0b0b0b0bbb0bbb00000bb000bb00000b0b00bb0b0b00000b0b0bbb0bb00bbb00000bbb00bb00000bbb0bbb0bbb0bbb000000000000000000000000000000000
b0b0b0b0b0b00b000000b0b0b0b00000b0b0b0b0b0b00000b0b0b0b0b0b00b0000000b00b0b00000b000b0b00b0000b000000000000000000000000000000000
b0b0bbb0bbb00b000000b0b0b0b00000bbb0b0b0b0b00000b0b0bbb0b0b00b0000000b00b0b00000bb00bbb00b000bb000000000000000000000000000000000
bbb0b0b0b0b00b000000b0b0b0b0000000b0b0b0b0b00000bbb0b0b0b0b00b0000000b00b0b00000b000b0b00b00000000000000000000000000000000000000
bbb0b0b0b0b00b000000bbb0bb000000bbb0bb000bb00000bbb0b0b0b0b00b0000000b00bb000000bbb0b0b00b000b0000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77700000770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07700000070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000700070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07000000777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

